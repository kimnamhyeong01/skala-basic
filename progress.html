<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Progress Bar 실습</title>

    <!-- Bootstrap CSS
         진행 바(progress bar)와 버튼 스타일을 빠르게 사용하기 위해 CDN으로 로드 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
        crossorigin="anonymous">
</head>

<body>

    <!-- Progress Bar 영역
         Bootstrap progress 컴포넌트를 사용하여 시각적인 진행 상태를 표현 -->
    <div class="progress m-5" role="progressbar">
        <!-- 실제로 width 값이 변경되는 막대 -->
        <div
            id="progressBar"
            class="progress-bar progress-bar-striped progress-bar-animated"
            style="width: 0%">
            0%
        </div>
    </div>

    <!-- 시작 버튼
         progress 동작을 시작하는 트리거 역할 -->
    <button id="startButton" type="button" class="btn btn-primary m-5">
        Primary
    </button>

    <!-- Bootstrap JS (필수는 아니지만 컴포넌트 안정성 확보용) -->
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <script>
        /* ===============================
           DOM 요소 가져오기
           =============================== */
        // 시작 버튼과 progress bar를 JS에서 제어하기 위해 DOM 객체로 가져온다
        const startButton = document.getElementById('startButton');
        const progressBar = document.getElementById('progressBar');

        /* ===============================
           상태 변수 선언
           =============================== */
        // 현재 진행률(%)을 저장하는 변수
        let progress = 0;

        // setInterval을 중단하기 위해 interval ID를 저장
        let intervalId = null;

        /* ===============================
           버튼 클릭 이벤트 등록
           =============================== */
        startButton.addEventListener('click', () => {

            //중복 실행 방지 (안전장치)
            if (intervalId !== null){
                clearInterval(intervalId);
            }

            // ▶ 진행 중 중복 클릭 방지
            // progress가 동작하는 동안 버튼을 비활성화하여
            // 여러 interval이 동시에 실행되는 문제를 막는다
            startButton.disabled = true;

            // ▶ progress 상태 초기화
            // 버튼을 다시 눌렀을 때 항상 0%부터 시작하도록 초기화
            progress = 0;
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';

            /* ===============================
               종료 시간 설정 (3~5초 랜덤)
               =============================== */
            // Math.random()을 이용해 3~5초 사이의 랜덤 종료 시간 생성
            // 실제 서버 응답 시간이 불확실한 상황을 가정한 시뮬레이션
            const finishTime = Math.floor(Math.random() * 3 + 3) * 1000;

            // 시작 시점을 기록하여 경과 시간 계산에 사용
            const startTime = Date.now();

            /* ===============================
               1초마다 progress 증가
               =============================== */
            intervalId = setInterval(() => {

                // 현재까지 경과된 시간 계산
                const elapsed = Date.now() - startTime;

                // ▶ 종료 시간 도달 시 처리
                // 아직 progress가 100%가 아니더라도
                // 종료 시간이 되면 즉시 100%로 만든다
                if (elapsed >= finishTime) {
                    clearInterval(intervalId);   // interval 중단
                    progress = 100;
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';

                    // ▶ 작업 완료 후 버튼 다시 활성화
                    startButton.disabled = false;
                    return;
                }

                // ▶ 정상 진행 구간
                // 1초마다 10%씩 증가하도록 설정
                // 90%까지만 증가시키고, 마지막은 종료 조건에서 100%로 처리
                if (progress < 90) {
                    progress += 10;
                    progressBar.style.width = progress + '%';
                    progressBar.textContent = progress + '%';
                }

            }, 1000); // 1초 간격
        });
    </script>

</body>
</html>
